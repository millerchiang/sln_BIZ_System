@using prj_BIZ_System.Models
@model IEnumerable<prj_BIZ_System.Models.ProductListModel>

@{
    ViewBag.Title = "ProductList";
}
@section pagestyle{
    <link href="/stylesheets/sys.css" rel="stylesheet" />
}
    <article class="article_col1">
        <section class="form_box w100 article_col1">
            <h2>崴奕公寓大廈管理維護有限公司</h2>
            <div class="databubox">
                <a href="company_info.html" class="databu databu05">公司資料</a>
                <a href="company_info_product.html" class="databu databu02 active">產品介紹</a>
                <a href="company_info_dm.html" class="databu databu03">線上型錄</a>
                <a href="company_info_dm_movie.html" class="databu databu04">影音型錄</a>
            </div>
            <div class="imgboxB">
                <img src="../../images/product/p12b.jpg" alt="">
            </div>
            <div class="magb30">

                <span class="regis_col02L regis_col_bg2">
                    類型:
                </span>
                <span class="regis_col02R contentspan">
                    生活用品
                </span>

                <span class="regis_col02L regis_col_bg2">
                    產品名稱:
                </span>
                <span class="regis_col02R contentspan">
                    The 1080P Hight Definition Mobile DVR
                </span>

                <span class="regis_col02L regis_col_bg2">
                    商品型號:
                </span>
                <span class="regis_col02R contentspan">
                    HDVR
                </span>

                <span class="regis_col02L regis_col_bg2">
                    產品資料:
                </span>
                <p class="regis_col02R contentspan">
                    The 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVR
                </p>

                <span class="regis_col02L regis_col_bg2">
                    商品專利/得獎:
                </span>
                <p class="regis_col02R contentspan">
                    The 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVR
                </p>


                <span class="regis_col02L regis_col_bg2">
                    商品規格或其它:
                </span>
                <p class="regis_col02R contentspan">
                    The 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVRThe 1080P Hight Definition Mobile DVR
                </p>



            </div>
            <div class="centerbox magb30">
                <a href="company_info_product.html" class="submitbu">回產品列表</a>
            </div>
        </section>

    </article>
<script>
    $(function () {
        init();
    });
    function init() {

        var $addItemLint = $("#addItemLink");
        var g_no = 1;
        $addItemLint.click(function (e) {
            $("table.regis_table").append(genTemplate(g_no++));
            $(this).appendTo($("table.regis_table tr").last().find("td").last());
        });

        $("tr._old_prods").find("input[type='text']").change(function () {
            $(this).parents("tr").find("input[name='isChanged']").val('true');
        });

        $("#deleteLink").click(function () {
            if (confirm("確認是否要刪除")) {
                var $selected = $("tr").find("input[name='product_id']:checked");
                var del_prods = [];
                $selected.each(function (index, el) {
                    var value = $(el).val();
                    if (value != null && value != '') {
                        del_prods.push(value);
                    }
                });
                var param = {
                    "del_prods": del_prods
                };

                $.ajax({
                    type: "post",
                    url: "@Url.Action("ProductDelete", "User")",
                    cache: false,
                    data: param,
                    dataType: "json"
                }).done(function(result) {
                    if (result == 'success') {
                        alert("刪除成功");
                    } else {
                        alert("刪除失敗");
                    }
                    location.reload();
                });
            }
        });

        $("#saveLink").click(function () {
            var old_prods = [];
            var new_prods = [];

            $("tr._old_prods").each(function (index, el) {
                var isChanged = $(el).find("input[name='isChanged']").val();
                if (isChanged == 'true') {
                    new_ProductListModel(old_prods, el);
                }
            });

            $("tr._new_prods").each(function (index, el) {
                new_ProductListModel(new_prods, el);
            });

            var param = {
                "old_prods": old_prods ,
                "new_prods": new_prods
            };

            $.ajax({
                type: "post",
                url: "@Url.Action("ProductInsert", "User")",
                cache: false,
                data: param,
                dataType: "json"
            }).done(function(result) {
                if (result == 'success') {
                    alert("新增成功");
                } else {
                    alert("新增失敗");
                }
                location.reload();
            });

        })
    }

    function new_ProductListModel(collection, el) {
        var product_id      = $(el).find("input[name='product_id']").val();
        var product_name    = $(el).find("input[name='product_name']").val();
        var product_name_en = $(el).find("input[name='product_name_en']").val();
        var product_info    = $(el).find("input[name='product_info']").val();
        var product_info_en = $(el).find("input[name='product_info_en']").val();
        if (product_name != '' || product_name_en != '' || product_info != '' || product_info_en!='') {
            collection.push(
                {
                    "product_id"      : product_id,
                    "product_name"    : product_name,
                    "product_name_en" : product_name_en,
                    "product_info"    : product_info,
                    "product_info_en" : product_info_en
                }
            );
        }
    }

    function genTemplate(no) {
        var template =
           '<tr class="_new_prods">                                                                                 ' +
           '	<td>                                                                                                ' +
           //'		<input type="checkbox" class="inputCheckbox" name="product_id" id="product'+ no +'" value="">   ' +
           //'		<label for="product'+no+'"></label>                                                             ' +
           '	</td>                                                                                               ' +
           '	<td>                                                                                                ' +
           '        <input type="text"  name="product_name"    value="" placeholder="請輸入產品中文名稱..">           ' +
           '	    <input type="text"  name="product_name_en" value="" placeholder="請輸入產品英文名稱..">           ' +
           '	</td>                                                                                               ' +
           '	<td>                                                                                                ' +
           '	    <input type="text"  name="product_info"    value="" placeholder="請輸入產品中文說明..">           ' +
           '	    <input type="text"  name="product_info_en" value="" placeholder="請輸入產品英文說明..">           ' +
           '	</td>                                                                                               ' +
           '	<td>                                                                                                ' +
           '	</td>                                                                                               ' +
           '</tr>                                                                                                   ' ;
        return template;
    }
</script>