<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="UserInfo"
        xmlns="http://ibatis.apache.org/mapping"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <alias>
    <typeAlias alias="UserInfoModel" type="prj_BIZ_System.Models.UserInfoModel"/>
    <typeAlias alias="EnterpriseSortListModel" type="prj_BIZ_System.Models.EnterpriseSortListModel"/>
    <typeAlias alias="EnterpriseSortModel" type="prj_BIZ_System.Models.EnterpriseSortModel"/>
    <typeAlias alias="CompanySortModel" type="prj_BIZ_System.Models.CompanySortModel"/>
    <typeAlias alias="ProductListModel" type="prj_BIZ_System.Models.ProductListModel"/>
    <typeAlias alias="CatalogListModel" type="prj_BIZ_System.Models.CatalogListModel"/>
  </alias>

  <statements>

    <!--查詢產業別全部-->
    <select id="SelectAll_sort" resultMap="Enterprise_sort-result">
      SELECT *
      FROM enterprise_sort_list
      ORDER BY enterprise_sort_id
    </select>



    <select id="SelectUserSortBySortId" parameterClass="CompanySortModel" resultMap="CompanySort-result">
      SELECT sort.user_id, sort.sort_id, user_info.company, user_info.company_en
      FROM enterprise_sort sort
      INNER JOIN user_info
      ON sort.user_id = user_info.user_id
      WHERE sort.sort_id = #sort_id# and (user_info.company like '%'||#company#||'%' or user_info.company_en like '%'||#company#||'%'  )
      ORDER BY user_info.company;
    </select>

    <select id="SelectUserKw" resultMap="UserInfo-result">
      SELECT *
      FROM user_info
      WHERE company like '%'||#company#||'%' or company_en like '%'||#company#||'%'
    </select>

    <!-- 
    <select id="SelectUserKw" parameterClass="UserinfoModel" resultMap="UserInfo-result">
      SELECT *
      FROM user_info
      WHERE company like '%'||#company#||'%' or company_en like '%'||#company#||'%'
      ORDER BY company;
    </select>
-->
    <!--
    [[  table=enterprise_sort
    >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    -->
    <!--查詢使用者產業別對應結果全部-->
    <select id="SelectUserSortByUserId" parameterClass="EnterpriseSortModel" resultMap="UserSort-result">
      SELECT sort.user_id, sort.sort_id, list.enterprise_sort_id, list.enterprise_sort_name
      FROM enterprise_sort sort
      INNER JOIN enterprise_sort_list list
      ON sort.sort_id = list.sort_id
      WHERE sort.user_id = #user_id#
      ORDER BY sort.user_id;


    </select>

    <delete id="DeleteUserSortByUserId" parameterClass="EnterpriseSortModel">
      DELETE FROM enterprise_sort
      WHERE user_id = #user_id#
    </delete>

    <insert id="InsertUserSortByUserId" parameterClass="EnterpriseSortModel">
      INSERT INTO enterprise_sort(user_id, sort_id)
      VALUES (#user_id#, #sort_id#);
    </insert>

    <!--
    <<<<<<<<<<<<<<<<<<<<<<<<<<<
    ]]
    -->


    <!--
    [[  table=catalog_list
    >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    -->
    <!--查詢型錄全部-->
    <select id="SelectCatalogListByUserId" parameterClass="CatalogListModel" resultMap="CatalogList-result">
      SELECT c.*, u.company
      FROM catalog_list c
      JOIN user_info u on c.user_id = u.user_id
      WHERE c.user_id = #user_id#
    </select>

    
    <!--查詢型錄全部-->
    <select id="SelectCatalogListTop" parameterType= "int" resultMap="CatalogList-result">
      SELECT c.* , u.company
      FROM catalog_list c
      JOIN user_info u on c.user_id = u.user_id
      Order By catalog_no Desc Limit $limit$

    </select>


    <!--查詢型錄部份-->
    <select id="SelectCatalogListByCatalogNo" parameterClass="CatalogListModel" resultMap="CatalogList-result">
      SELECT c.* , u.company
      FROM catalog_list c
      JOIN user_info u on c.user_id = u.user_id
      WHERE c.user_id = #user_id# and c.catalog_no = #catalog_no#
    </select>

    <!--刪除型錄-->
    <delete id="DeleteCatalogListByCatalogNo" parameterClass="CatalogListModel">
      DELETE FROM catalog_list
      WHERE user_id = #user_id# and catalog_no = #catalog_no#
    </delete>

    <!--新增型錄-->
    <insert id="InsertCatalogList" parameterClass="CatalogListModel">
      INSERT INTO catalog_list(
      user_id,catalog_name, cover_file, catalog_file, deleted)
      VALUES (#user_id#,#catalog_name#,#cover_file#,#catalog_file#,#deleted#)
    </insert>

    <!--
    <<<<<<<<<<<<<<<<<<<<<<<<<<<
    ]]
    -->


    <!--
    [[  table = product_list
    >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    -->
    <!--查詢產品全部-->
    <select id="SelectProductListByUserId" parameterClass="ProductListModel" resultMap="ProductList-result">
      SELECT *
      FROM product_list
      WHERE user_id = #user_id#
    </select>

    <!--刪除產品-->
    <delete id="DeleteProductListByProductId" parameterClass="ProductListModel">
      DELETE FROM product_list
      WHERE user_id = #user_id#
      and product_id = #product_id#
    </delete>

    <!--新增產品-->
    <insert id="InsertProductList" parameterClass="ProductListModel">
      INSERT INTO product_list(
      user_id, product_name, product_info, product_name_en,
      product_info_en, deleted)
      VALUES (#user_id#,#product_name#,#product_info#,#product_name_en#
      ,#product_info_en#,#deleted#
      )
    </insert>

    <!--更新產品-->
    <update id="UpdateProductList" parameterClass="ProductListModel">
      UPDATE product_list
      SET user_id=#user_id#, product_name=#product_name#, product_info=#product_info#, product_name_en=#product_name_en#,
      product_info_en=#product_info_en#, deleted=#deleted#
      WHERE product_id=#product_id#
    </update>
    <!--
    <<<<<<<<<<<<<<<<<<<<<<<<<<<
    ]]
    -->
    <!--查詢全部-->
    <select id="SelectAll" resultMap="UserInfo-result">
      SELECT *
      FROM user_info
      ORDER BY create_time DESC Limit 10
    </select>

    <!--關鍵字查詢-->
    <select id="SelectAllkw" resultMap="UserInfo-result">
      SELECT *
      FROM user_info
      <dynamic prepend="where">
        <isNotEmpty prepend="and" property="user_id">
          user_id  like '%'||#user_id#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="and" property="company">
          company like '%'||#company#||'%'
        </isNotEmpty>
      </dynamic>
      ORDER BY update_time DESC
    </select>


    <!--查詢單筆-->
    <select id="SelectOne" resultMap="UserInfo-result">
      SELECT *
      FROM user_info
      WHERE user_id = #user_id#
    </select>

    <!--查詢名稱密碼-->
    <select id="CheckOne" resultMap="UserInfo-result">
      SELECT *
      FROM user_info
      WHERE user_id = #user_id# and user_pw = #user_pw#
    </select>


    <!--新增單筆-->
    <insert id="InsertOne" parameterClass="prj_BIZ_System.Models.UserInfoModel">
      <selectKey resultClass="int" property="id" type="post">
        SELECT currval('user_info_seq')
      </selectKey>
      INSERT INTO user_info (
      user_id, user_pw,id_enable,
      enterprise_type, company, leader,
      addr, contact, phone, email, capital, revenue, website, info,
      logo_img, company_en, leader_en, addr_en, contact_en, info_en
      ) VALUES (
      #user_id#, #user_pw#,#id_enable#,
      #enterprise_type#, #company#, #leader#,
      #addr#, #contact#, #phone#, #email#, #capital#, #revenue#, #website#, #info#,
      #logo_img#, #company_en#, #leader_en#, #addr_en#, #contact_en#, #info_en#
      )
    </insert>

    <!--刪除單筆-->
    <delete id="DeleteOne" parameterClass="prj_BIZ_System.Models.UserInfoModel">
      DELETE FROM user_info
      WHERE user_id = #user_id#
    </delete>


    <!--修改單筆-->
    <update id="UpdateOne" parameterClass="prj_BIZ_System.Models.UserInfoModel">
      UPDATE user_info
      SET user_pw = #user_pw#,
      enterprise_type = #enterprise_type#,
      company = #company#,
      id_enable = #id_enable#,
      leader = #leader#,
      addr = #addr#,
      contact = #contact#,
      phone = #phone#,
      email = #email#,
      capital = #capital#,
      revenue = #revenue#,
      website = #website#,
      info = #info#,
      logo_img = #logo_img#,
      company_en = #company_en#,
      leader_en = #leader_en#,
      addr_en = #addr_en#,
      contact_en = #contact_en#,
      info_en = #info_en#,
      update_time = #update_time#
      WHERE user_id = #user_id#
    </update>

    <update id="UpdateIdEnable" parameterClass="UserInfoModel">
      UPDATE user_info
      SET id_enable = #id_enable#
      WHERE id = $id$
    </update>
  </statements>

  <resultMaps>
    <resultMap id="UserInfo-result" class="prj_BIZ_System.Models.UserInfoModel">
      <!--property是Model屬性,column是資料庫欄位名稱-->
      <result property="id" column="id"/>
      <result property="user_id" column="user_id"/>
      <result property="user_pw" column="user_pw"/>
      <result property="id_enable" column="id_enable"/>
      <result property="enterprise_type" column="enterprise_type"/>
      <result property="company" column="company"/>
      <result property="leader" column="leader"/>
      <result property="addr" column="addr"/>
      <result property="contact" column="contact"/>
      <result property="phone" column="phone"/>
      <result property="email" column="email"/>
      <result property="capital" column="capital"/>
      <result property="revenue" column="revenue"/>
      <result property="website" column="website"/>
      <result property="info" column="info"/>
      <result property="create_time" column="create_time"/>
      <result property="update_time" column="update_time"/>
      <result property="last_login_time" column="last_login_time"/>
      <result property="logo_img" column="logo_img"/>
      <result property="company_en" column="company_en"/>
      <result property="leader_en" column="leader_en"/>
      <result property="addr_en" column="addr_en"/>
      <result property="contact_en" column="contact_en"/>
      <result property="info_en" column="info_en"/>
    </resultMap>

    <resultMap id="Enterprise_sort-result" class="prj_BIZ_System.Models.EnterpriseSortListModel">
      <result property="sort_id" column="sort_id"/>
      <result property="enterprise_sort_id" column="enterprise_sort_id"/>
      <result property="enterprise_sort_name" column="enterprise_sort_name"/>
    </resultMap>

    <resultMap id="UserSort-result" class="prj_BIZ_System.Models.EnterpriseSortModel">
      <result property="user_id" column="user_id"/>
      <result property="sort_id" column="sort_id"/>
      <result property="enterprise_sort_id" column="enterprise_sort_id"/>
      <result property="enterprise_sort_name" column="enterprise_sort_name"/>
    </resultMap>

    <resultMap id="CompanySort-result" class="prj_BIZ_System.Models.CompanySortModel">
      <result property="user_id" column="user_id"/>
      <result property="sort_id" column="sort_id"/>
      <result property="company" column="company"/>
      <result property="company_en" column="company_en"/>
    </resultMap>
    
    <resultMap id="CatalogList-result" class="prj_BIZ_System.Models.CatalogListModel">
      <result property="catalog_no" column="catalog_no" />
      <result property="user_id" column="user_id" />
      <result property="catalog_name" column="catalog_name" />
      <result property="cover_file" column="cover_file" />
      <result property="catalog_file" column="catalog_file" />
      <result property="deleted" column="deleted" />
      <result property="company" column="company" />
    </resultMap>

    <resultMap id="ProductList-result" class="prj_BIZ_System.Models.ProductListModel">
      <result property="product_id" column="product_id"/>
      <result property="user_id" column="user_id"/>
      <result property="product_name" column="product_name"/>
      <result property="product_info" column="product_info"/>
      <result property="product_name_en" column="product_name_en"/>
      <result property="product_info_en" column="product_info_en"/>
      <result property="deleted" column="deleted"/>
    </resultMap>

  </resultMaps>

</sqlMap>

