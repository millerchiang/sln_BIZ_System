<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="Match"
        xmlns="http://ibatis.apache.org/mapping"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <alias>
    <typeAlias alias="MatchmakingNeedModel" type="prj_BIZ_System.Models.MatchmakingNeedModel"/>
  </alias>

  <statements>

    <!--
    [[  table = activity_register
    >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    -->
      <!--查詢帳戶已審核通過的活動-->
      <select id="SelectAccountPassActivity" resultMap="ActivityRegister" parameterClass="ActivityRegisterModel">
        SELECT *
        FROM activity_register r
        INNER JOIN user_info u
        ON  r.user_id = u.user_id
        INNER JOIN activity_info a
        ON r.activity_id = a.activity_id
        WHERE r.manager_check  = '1'
        AND r.user_id = #user_id#
      </select>
    
      <!--查詢帳戶未報名的活動-->
      <select id="SelectAccountNotRegisterActivity" resultMap="ActivityInfo" parameterClass="ActivityRegisterModel">
        SELECT *
        FROM activity_info a
        WHERE a.activity_id NOT IN
        (
          SELECT r.activity_id
          FROM activity_register r
          WHERE r.user_id = #user_id#
        )
      </select>
    <!--
    <<<<<<<<<<<<<<<<<<<<<<<<<<<
    ]]
    -->
    
    <!--
    [[  table = buyer_list
    >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    -->
      <!--查詢賣家要媒合的買家名稱與買家需求-->
      <select id="SelectSellerMatchToBuyerNameAndNeed" resultMap="BuyerInfo" parameterClass="BuyerInfoModel">
        SELECT *
        FROM buyer_list bl
        INNER JOIN user_info ui
        ON bl.buyer_id = ui.user_id
        WHERE bl.activity_id = #activity_id#
      </select>
    <!--
    <<<<<<<<<<<<<<<<<<<<<<<<<<<
    ]]
    -->

  </statements>

  <resultMaps>
    <resultMap id="MatchmakingNeed" class="MatchmakingNeedModel">
      <!--property是Model屬性,column是資料庫欄位名稱-->
      <result property="serial_no" column="serial_no"/>
      <result property="activity_id" column="activity_id"/>
      <result property="seller_id" column="seller_id"/>
      <result property="buyer_id" column="buyer_id"/>
      <result property="buyer_reply" column="buyer_reply"/>
    </resultMap>

    <resultMap id="ActivityRegister" class="ActivityRegisterModel">
      <!--property是Model屬性,column是資料庫欄位名稱-->
      <result property="register_id" column="register_id"/>
      <result property="activity_id" column="activity_id"/>
      <result property="user_id" column="user_id"/>
      <result property="quantity" column="quantity"/>
      <result property="name_a" column="name_a"/>
      <result property="title_a" column="title_a"/>
      <result property="name_b" column="name_b"/>
      <result property="title_b" column="title_b"/>
      <result property="telephone" column="telephone"/>
      <result property="phone" column="phone"/>
      <result property="email" column="email"/>
      <result property="catalog_file" column="catalog_file"/>
      <result property="manager_check" column="manager_check"/>
      <result property="user_info" column="user_info"/>
      <result property="user_info_en" column="user_info_en"/>
      <result property="create_time" column="create_time"/>
      <result property="update_time" column="update_time"/>
      <!-- activityInfo 的 activity_name-->
      <result property="activity_name" column="activity_name"/>
    </resultMap>

    <resultMap id="ActivityInfo" class="ActivityInfoModel">
      <!--property是Model屬性,column是資料庫欄位名稱-->
      <result property="activity_id" column="activity_id"/>
      <result property="manager_id" column="manager_id"/>
      <result property="activity_type" column="activity_type"/>
      <result property="activity_name" column="activity_name"/>
      <result property="starttime" column="starttime"/>
      <result property="endtime" column="endtime"/>
      <result property="addr" column="addr"/>
      <result property="organizer" column="organizer"/>
      <result property="name" column="name"/>
      <result property="phone" column="phone"/>
      <result property="email" column="email"/>
      <result property="seller_select" column="seller_select"/>
      <result property="matchmaking_select" column="matchmaking_select"/>
      <result property="activity_name_en" column="activity_name_en"/>
      <result property="addr_en" column="addr_en"/>
      <result property="organizer_en" column="organizer_en"/>
      <result property="create_time" column="create_time"/>
      <result property="update_time" column="update_time"/>
    </resultMap>

    <resultMap id="BuyerInfo" class="BuyerInfoModel">
      <!--property是Model屬性,column是資料庫欄位名稱-->
      <result property="serial_no" column="serial_no"/>
      <result property="activity_id" column="activity_id"/>
      <result property="buyer_id" column="buyer_id"/>
      <result property="buyer_need" column="buyer_need"/>
      <!-- UserInfo 的 company-->
      <result property="company" column="company"/>
    </resultMap> 
    
  </resultMaps>
  
</sqlMap>
