<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="Message"
        xmlns="http://ibatis.apache.org/mapping"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <alias>
    <typeAlias alias="MsgPrivate" type="prj_BIZ_System.Models.MsgPrivateModel"/>
    <typeAlias alias="MsgPrivateFile"   type="prj_BIZ_System.Models.MsgPrivateFileModel"/>
    <typeAlias alias="MsgPrivateReply"   type="prj_BIZ_System.Models.MsgPrivateReplyModel"/>
  </alias>

  <statements>
    
    <!--私訊列表-->
    <select id="SelectMsgPrivate" resultMap="MsgPrivate-result" parameterClass="string">
      SELECT *
      FROM message.msg_private
      <dynamic prepend="where">
        <isNotEmpty prepend="and" property="value">
          msg_title like '%'||#value#||'%' or msg_content '%'||#value#||'%'
        </isNotEmpty>
      </dynamic>
    </select>

    <!--建立新私訊-->
    <insert id="InsertMsgPrivate" parameterClass="MsgPrivate">
      INSERT INTO message.msg_private(
      creater_id, msg_title, msg_content, msg_member )
      VALUES (#creater_id#, #msg_title#, #msg_content# , #msg_member# );
    </insert>

    <!--查詢單一私訊-->
    <select id="SelectMsgPrivateOne" resultMap="MsgPrivate-result" parameterClass="MsgPrivate">
      SELECT *
      FROM message.msg_private
      WHERE msg_no = #msg_no#
    </select>

    <!--查詢私訊附件-->
    <select id="SelectMsgPrivateFileByMsg_no" resultMap="MsgPrivateFile-result" parameterClass="MsgPrivate">
      SELECT *
      FROM message.msg_private_file
      WHERE msg_no=#msg_no#
    </select>

    <!--查詢私訊回應-->
    <select id="SelectMsgPrivateReplyMsg_no" resultMap="MsgPrivateReply-result" parameterClass="MsgPrivate">
      SELECT *
      FROM message.msg_private_reply
      where msg_no=#msg_no#
      order by msg_reply_no
    </select>

  </statements>

  <resultMaps>

    <resultMap id="MsgPrivate-result" class="prj_BIZ_System.Models.MsgPrivateModel">
      <!--property是Model屬性,column是資料庫欄位名稱-->
      <result property="msg_no" column="msg_no"></result>
      <result property="creater_id" column="creater_id"></result>
      <result property="msg_title" column="msg_title"></result>
      <result property="msg_content" column="msg_content"></result>
      <result property="msg_member" column="msg_member"></result>
      <result property="create_time" column="create_time"></result>
    </resultMap>

    <resultMap id="MsgPrivateFile-result" class="prj_BIZ_System.Models.MsgPrivateFileModel">
      <!--property是Model屬性,column是資料庫欄位名稱-->
      <result property="msg_file_no" column="msg_file_no"></result>
      <result property="msg_no" column="msg_no"></result>
      <result property="msg_file_site" column="msg_file_site"></result>
      <result property="create_time" column="create_time"></result>
    </resultMap>

    <resultMap id="MsgPrivateReply-result" class="prj_BIZ_System.Models.MsgPrivateReplyModel">
      <!--property是Model屬性,column是資料庫欄位名稱-->
      <result property="msg_reply_no" column="msg_reply_no"></result>
      <result property="msg_no" column="msg_no"></result>
      <result property="msg_reply" column="msg_reply"></result>
      <result property="reply_content" column="reply_content"></result>
      <result property="create_time" column="create_time"></result>
    </resultMap>
   
  </resultMaps>

</sqlMap>

